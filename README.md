# Activerecord::PedantMysql2

[![Build Status](https://secure.travis-ci.org/Shopify/activerecord-pedantmysql2-adapter.png)](http://travis-ci.org/Shopify/activerecord-pedantmysql2-adapter)
[![Code Climate](https://codeclimate.com/github/Shopify/activerecord-pedantmysql2-adapter.png)](https://codeclimate.com/github/Shopify/activerecord-pedantmysql2-adapter)
[![Coverage Status](https://coveralls.io/repos/Shopify/activerecord-pedantmysql2-adapter/badge.png)](https://coveralls.io/r/Shopify/activerecord-pedantmysql2-adapter)
[![Gem Version](https://badge.fury.io/rb/activerecord-pedantmysql2-adapter.png)](http://badge.fury.io/rb/activerecord-pedantmysql2-adapter)


ActiveRecord adapter for MySQL that report warnings.

The main usage is to progressively identify and fix MySQL warnings generated by legacy rails applications, and ultimately enable strict mode. 

Alternatively it can be used to treat all MySQL warnings as errors.

## Installation

Add this line to your application's Gemfile:

    gem 'activerecord-pedantmysql2-adapter'

And then execute:

    $ bundle

Finally in your `database.yml`:

    adapter: pedant_mysql2


## Usage

By default it do nothing with the warnings, you have to define the behaviour yourself in an initializer.

You can either raise on all errors:

```ruby
  PedantMysql2.on_warning = lambda { |warning| raise warning }
```

Or report them to your exception tracker:

```ruby
  PedantMysql2.on_warning = lambda { |warning| Airbrake.notify(warning) }
```

Or whatever else behaviour you want (logging).

You can easilly whitelist some types of warnings:

```ruby

PedantMysql2.on_warning = lambda do |warning|
  raise warning unless WARNINGS_WHITELIST.any? { |pattern| pattern =~ warning.message }
end

```

If you want to be able to have some queries react silently to MySQL warnings you can
do the following:

```ruby

PedantMysql2.on_warning = lambda do |warning|
  if PedantMysql2.silence_warnings?
    # handle the warning a certain way or return
  else
    # simply pass the warning to the caller
    raise warning
  end
end

PedantMysql2.silence_warnings do
  # perform query that may raise an error you want to stifle
end
 ```

## Development

Setting up the development environment is very straightforward. In order to keep the test
as simple as possible we rely on your MySQL database to have a `travis` user and a
`pedant_mysql2_test` database.

You can set this up easily using the following commands as your `root` MySQL user:

```
CREATE USER 'travis'@'localhost';
CREATE DATABASE pedant_mysql2_test;
GRANT ALL PRIVILEGES ON pedant_mysql2_test.* TO 'travis'@'localhost';
```

## Contributing

1. Fork it ( http://github.com/Shopify/activerecord-pedantmysql2-adapter/fork )
2. Create your feature branch (`git checkout -b my-new-feature`)
3. Commit your changes (`git commit -am 'Add some feature'`)
4. Push to the branch (`git push origin my-new-feature`)
5. Create new Pull Request
